<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.yufu.fs.dao.ClearMerStlFinalBookBakMapper">

  <resultMap id="BaseResultMap" type="cn.yufu.fs.entity.ClearMerStlFinalBookBak">
    <id column="ID" jdbcType="VARCHAR" property="id" />
    <result column="GEN_DT" jdbcType="VARCHAR" property="genDt" />
    <result column="TERM_MER_NO" jdbcType="VARCHAR" property="termMerNo" />
    <result column="MER_NO" jdbcType="VARCHAR" property="merNo" />
    <result column="SCENE" jdbcType="VARCHAR" property="scene" />
    <result column="MER_NAME" jdbcType="VARCHAR" property="merName" />
    <result column="STL_DATE" jdbcType="VARCHAR" property="stlDate" />
    <result column="START_STL_DATE" jdbcType="VARCHAR" property="startStlDate" />
    <result column="END_STL_DATE" jdbcType="VARCHAR" property="endStlDate" />
    <result column="CONSUM_NUM" jdbcType="DECIMAL" property="consumNum" />
    <result column="CONSUM_AMT" jdbcType="DECIMAL" property="consumAmt" />
    <result column="NET_AMT" jdbcType="DECIMAL" property="netAmt" />
    <result column="FEE" jdbcType="DECIMAL" property="fee" />
    <result column="TRAN_AMT" jdbcType="DECIMAL" property="tranAmt" />
    <result column="STLACC_ID" jdbcType="DECIMAL" property="stlaccId" />
    <result column="ACC_NO" jdbcType="VARCHAR" property="accNo" />
    <result column="ACC_BANK_NAME" jdbcType="VARCHAR" property="accBankName" />
    <result column="ACCOUNT_NAME" jdbcType="VARCHAR" property="accountName" />
    <result column="BANK_UNION" jdbcType="VARCHAR" property="bankUnion" />
    <result column="BANK_CODE" jdbcType="VARCHAR" property="bankCode" />
    <result column="BEIJING_FLAG" jdbcType="VARCHAR" property="beijingFlag" />
    <result column="PAYOUT_DATE" jdbcType="VARCHAR" property="payoutDate" />
    <result column="PAYOUT_JUNL" jdbcType="VARCHAR" property="payoutJunl" />
    <result column="SEQ_NO" jdbcType="VARCHAR" property="seqNo" />
    <result column="PAYOUT_STATUS" jdbcType="VARCHAR" property="payoutStatus" />
    <result column="COMMENTS" jdbcType="VARCHAR" property="comments" />
    <result column="PROVINCE_CODE" jdbcType="DECIMAL" property="provinceCode" />
    <result column="PROVINCE_NAME" jdbcType="VARCHAR" property="provinceName" />
    <result column="BJ_FLAG" jdbcType="VARCHAR" property="bjFlag" />
    <result column="CARD_TYPE" jdbcType="VARCHAR" property="cardType" />
    <result column="EXELUSIVE_CARD_FLAG" jdbcType="VARCHAR" property="exelusiveCardFlag" />
    <result column="STL_NEED_FLAG" jdbcType="VARCHAR" property="stlNeedFlag" />
    <result column="CARD_TYPE_NAME" jdbcType="VARCHAR" property="cardTypeName" />
    <result column="CITY_CODE" jdbcType="DECIMAL" property="cityCode" />
    <result column="CITY_NAME" jdbcType="VARCHAR" property="cityName" />
    <result column="MERGE_MONEY_FLAG" jdbcType="CHAR" property="mergeMoneyFlag" />
    <result column="RESERVED_FIELD" jdbcType="VARCHAR" property="merchantOrg" />
    <result column="RESERVED_FIELD_1" jdbcType="VARCHAR" property="merchantAmt" />
    <result column="SETTLEMENT_PERSON" jdbcType="VARCHAR" property="settlementPerson" />
  	
  	<result column="PAY_ACCOUNT_TYPE" jdbcType="VARCHAR" property="payAccountType" />
  	<result column="ACC_PROVINCE_NAME" jdbcType="VARCHAR" property="accProvinceName" />
  	<result column="ACC_CITY_NAME" jdbcType="VARCHAR" property="accCityName" />
  	<result column="ACC_X_TEXT" jdbcType="VARCHAR" property="accXText" />
  	<result column="START_STL_DATE_N" jdbcType="VARCHAR" property="startStlDateN" />
  	<result column="END_STL_DATE_N" jdbcType="VARCHAR" property="endStlDateN" />
  	<result column="COMBINE_FLAG" jdbcType="VARCHAR" property="combineFlag" />
  </resultMap>
  
  <sql id="Example_Where_Clause">
    <where>
      <foreach collection="example.oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause">
    <where>
      <foreach collection="example.oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  
  <sql id="Base_Column_List">
    ID, GEN_DT, TERM_MER_NO, MER_NO, SCENE, MER_NAME, STL_DATE, START_STL_DATE, END_STL_DATE, 
    CONSUM_NUM, round(CONSUM_AMT,2) as CONSUM_AMT,round(NET_AMT,2) as NET_AMT ,round(FEE,2) as FEE ,
    round(TRAN_AMT,2) as TRAN_AMT, STLACC_ID, ACC_NO, ACC_BANK_NAME, 
    ACCOUNT_NAME, BANK_UNION, BANK_CODE, BEIJING_FLAG, PAYOUT_DATE, PAYOUT_JUNL, SEQ_NO, 
    PAYOUT_STATUS, COMMENTS, PROVINCE_CODE, PROVINCE_NAME, BJ_FLAG, CARD_TYPE, EXELUSIVE_CARD_FLAG, 
    STL_NEED_FLAG, CARD_TYPE_NAME, CITY_CODE, CITY_NAME,MERGE_MONEY_FLAG,reserved_field,reserved_field_1,
    SETTLEMENT_PERSON, PAY_ACCOUNT_TYPE, ACC_PROVINCE_NAME, ACC_CITY_NAME, ACC_X_TEXT,
    START_STL_DATE_N,END_STL_DATE_N,COMBINE_FLAG
  </sql>
  <select id="selectByExample" parameterType="cn.yufu.fs.entity.ClearMerStlFinalBookBakExample" resultMap="BaseResultMap">
    select
    <if test="example.distinct">
      example.distinct
    </if>
    <include refid="Base_Column_List" />
    from T_CLEAR_MERSTL_FINAL_BOOK_DTL a
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="example.orderByClause != null">
      order by ${example.orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from T_CLEAR_MERSTL_FINAL_BOOK_DTL
    where ID = #{id,jdbcType=VARCHAR}
  </select>
 
  <select id="countByExample" parameterType="cn.yufu.fs.entity.ClearMerStlFinalBookBakExample" resultType="java.lang.Integer">
    select count(*) from T_CLEAR_MERSTL_FINAL_BOOK_DTL a
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </select>
    
  <select id="selectPageByExample" parameterType="map" resultMap="BaseResultMap">
		SELECT * FROM (
		SELECT c.*, ROWNUM rn FROM(
		SELECT
		<include refid="Base_Column_List" />
		FROM T_CLEAR_MERSTL_FINAL_BOOK_DTL a
		<if test="_parameter != null">
			<include refid="Example_Where_Clause" />
		</if>
		<if test="example.orderByClause != null">
			order by ${example.orderByClause}
		</if>) c
		WHERE <![CDATA[ ROWNUM <= ${endResult} ]]>)
		WHERE rn &gt; ${startResult}
  </select> 
   
  <select id="getSumAmtByExample" parameterType="cn.yufu.fs.entity.ClearMerStlFinalBookBakExample" resultType="java.lang.String">
		select sum(consum_num) || '#' ||to_char(sum(consum_amt),'fm999999999999990.90')|| '#' ||to_char(sum(tran_amt),'fm999999999999990.90')|| '#' ||
		       to_char(sum(net_amt),'fm999999999999990.90')|| '#' || to_char(sum(fee),'fm999999999999990.90')  as fee
		  from T_CLEAR_MERSTL_FINAL_BOOK_DTL a
      <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </select>    
  
  <select id="selectGroupSumByExample" parameterType="cn.yufu.fs.entity.ClearMerStlFinalBookBakExample" resultMap="BaseResultMap">
	select a.province_code,
	       a.province_name,
	       a.city_code,
	       a.city_name,
	       sum(a.consum_num) as consum_num,
	       to_char(sum(a.consum_amt), 'fm999999999999990.90') as consum_amt,
	       to_char(sum(a.fee), 'fm999999999999990.90') as fee,
	       to_char(sum(a.net_amt), 'fm999999999999990.90') as net_amt,
	       to_char(sum(a.tran_amt), 'fm999999999999990.90') as tran_amt
	  from T_CLEAR_MERSTL_FINAL_BOOK_DTL a
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
     group by province_code, province_name, city_code, city_name  
    <if test="example.orderByClause != null">
      order by ${example.orderByClause}
    </if>
  </select> 
  
  <update id="updatePayoutStatusOneToThree" parameterType="cn.yufu.fs.entity.ClearMerStlFinalBookBak">   
	update T_CLEAR_MERSTL_FINAL_BOOK_DTL t set t.payout_status='3' where t.payout_status='1' and t.id = #{id,jdbcType=VARCHAR}
  </update>
 
  <update id="updatePayoutStatusZeroToOne" parameterType="cn.yufu.fs.entity.ClearMerStlFinalBookBak">   
	update T_CLEAR_MERSTL_FINAL_BOOK_DTL t set t.payout_status='1' where t.payout_status='0' and t.id = #{id,jdbcType=VARCHAR}
  </update>

  <update id="updatePayoutStatusTwoToEight" parameterType="cn.yufu.fs.entity.ClearMerStlFinalBook">
    	update T_CLEAR_MERSTL_FINAL_BOOK_DTL t set t.payout_status='8' where t.payout_status='2' and t.id = #{id,jdbcType=VARCHAR}
  </update>
   
</mapper>